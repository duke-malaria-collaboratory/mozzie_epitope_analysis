---
title: "Overall risk of reinfection"
author: "Christine Markwalter"
date: "11/23/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(dpi=300)
grDevices::pdf.options(useDingbats = FALSE)
library(Biostrings)
#library(ggplot2) #redundant
#library(dplyr) #redundant
library(tidyverse)
library(ggpmisc)
library(lubridate)
library(randomForest)

library(survival)
library(survminer)
library(coxme)
library(forestplot)

library(ggfortify)
library(ggseqlogo)
library(arsenal)

library(ggpubr)
library(gmodels)
```

# Color scheme
```{r}
strat_colors = c("#87B4C0", "#CE5B3B")
```


# Read in data
```{r, warning=F,message=F}
HumanData<-read.csv("data/original/spat21_human_final_censored_data_for_dissertation_with_exposure_outcome_1MAR2020.csv")

season <- readRDS("data/original/spat21_mosquito_anopheles_merged_data_18JAN2019.RDS") %>%
  mutate(collection_year = year(collection_date)) %>%
  group_by(collection_year, collection_week) %>%
  mutate(n_week = n()) %>%
  mutate(week_year = paste0(collection_week,"_", collection_year)) %>%
  ungroup() %>%
  arrange(ymd(collection_date)) %>%
  select(week_year, n_week) %>%
  unique() %>%
  mutate(mosquito_prev2weeks = lag(n_week,2) + lag(n_week,1)) %>%
  mutate(mosquito_prev_2weeks_cat = ifelse(mosquito_prev2weeks <= 50, "0 - 50 mosquitoes", ifelse(mosquito_prev2weeks > 50, "> 50 mosquitoes", NA)),
         mosquito_prev_2weeks_cat = factor(mosquito_prev_2weeks_cat, levels = c("0 - 50 mosquitoes", "> 50 mosquitoes"))) %>%
  select(week_year,mosquito_prev_2weeks_cat) %>%
  unique()

```


# Shaping human data
From Kelsey's CID paper: An asymptomatic infection was P. falciparum-positive by qPCR in a person lacking symptoms during a monthly follow-up visit. A symptomatic infection was P. falciparum-positive by RDT and qPCR in a person with at least 1 malaria symptom (ie, fever, aches, vomiting, diarrhea, chills, cough, or congestion) during a sick visit.

A quick look at HumanData shows that there are 364 samples that were classified as neither asymptomatic nor symptomatic. Below are the pcr and rdt results for those samples:

```
pcr/rdt |  invalid   negative    positive
--------| -------   --------    --------
negative|    0       189           39
positive|    2       117           17
```
ALL discordant pcr/rdt results from HumanData were left unclassified. Additionally, there were 17 samples from sick visits where rdt and pcr were both positive, but the symptoms that were reported were not malaria symptoms as defined above. The 189 pcr/rdt negative samples that were not classified originated from sick visits and not regular monthly visits (this shouldn't have any bearing on our analyses here).

__Below, we want to determine whether infections are the start, middle, or end of an episode. We will do this by checking the pcr status of the previous and next infections, with the following exceptions:__

**1) All symptomatic infections end an episode, since they received treatment**

**2) Any infections within 14 days of a symptomatic infection will be removed from the dataset and assumed to be remnant parasites/DNA from a treated infection**


```{r}
HDS<-HumanData %>% 
  dplyr::select(sample_name_dbs,unq_memID,sample_id_date,main_outcome_primary_case_def,main_exposure_primary_case_def)%>%
  filter(main_exposure_primary_case_def == "asymptomatic infection" | main_outcome_primary_case_def == "symptomatic infection") %>%
  mutate(symptomatic_status = ifelse(is.na(main_exposure_primary_case_def), as.character(main_outcome_primary_case_def),as.character(main_exposure_primary_case_def))) %>%
  dplyr::select(-c(main_exposure_primary_case_def,main_outcome_primary_case_def))
head(HDS)

classified_infections <- HumanData %>%
  select(unq_memID,pf_pcr_infection_status,sample_id_date,sample_name_dbs,age_y_baseline,gender,pfr364Q_std_combined, main_exposure_primary_case_def, main_outcome_primary_case_def)%>%
  mutate(symptomatic_status = ifelse(is.na(main_exposure_primary_case_def), as.character(main_outcome_primary_case_def),as.character(main_exposure_primary_case_def))) %>%
  arrange(unq_memID, ymd(sample_id_date)) %>% 
  group_by(unq_memID) %>% 
  #add columns for previous and next infections so that we can filter out anything within 14 days of a symptomatic infection
  mutate(pcr_next = lead(pf_pcr_infection_status,1),
         pcr_prev = lag(pf_pcr_infection_status,1),
         Sx_next = lead(symptomatic_status,1),
         Sx_prev = lag(symptomatic_status,1),
         days_since_prev = ymd(sample_id_date) - ymd(lag(sample_id_date,1))) %>%
  #remove positive samples within 14 days of a symptomatic infection (there are 25 of them)
  filter(Sx_prev != "symptomatic infection"| is.na(Sx_prev) | days_since_prev > days(14) | pf_pcr_infection_status != "positive") %>%
  #do it again to see if there are any other positive samples within 14 days of a symptomatic infection
  mutate(pcr_next = lead(pf_pcr_infection_status,1),
         pcr_prev = lag(pf_pcr_infection_status,1),
         Sx_next = lead(symptomatic_status,1),
         Sx_prev = lag(symptomatic_status,1),
         days_since_prev = ymd(sample_id_date) - ymd(lag(sample_id_date,1))) %>% #no more samples needed to be removed
  select(-days_since_prev) %>%
  #define whether samples are the the start middle or end of an infection
  mutate(StartMiddleEnd=case_when(pf_pcr_infection_status=="negative" ~ "negative",
                                  symptomatic_status == "symptomatic infection" & (pcr_prev == "negative" | is.na(pcr_prev) ) ~ "start+end",
                                  symptomatic_status == "symptomatic infection" & pcr_prev == "positive" & Sx_prev == "symptomatic infection" ~ "start+end",
                                  symptomatic_status == "symptomatic infection" & pcr_prev == "positive" & (Sx_prev == "asymptomatic infection" | is.na(Sx_prev)) ~ "end",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & (pcr_prev == "negative" | is.na(pcr_prev)) & (pcr_next == "negative" | is.na(pcr_next)) ~ "start+end",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & (pcr_prev == "negative" | is.na(pcr_prev)) & pcr_next == "positive" ~ "start",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & pcr_prev == "positive" & Sx_prev == "symptomatic infection" & (pcr_next == "negative" | is.na(pcr_next)) ~ "start+end",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & pcr_prev == "positive" & Sx_prev == "symptomatic infection" & pcr_next == "positive" ~ "start",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & pcr_prev == "positive" & (Sx_prev == "asymptomatic infection" | is.na(Sx_prev)) & (pcr_next == "negative" | is.na(pcr_next)) ~ "end",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & pcr_prev == "positive" & (Sx_prev == "asymptomatic infection" | is.na(Sx_prev)) & pcr_next == "positive" ~ "middle"))%>%
  #remove pf negative samples
  filter(pf_pcr_infection_status=="positive")%>%
  #Remove middle samples
  filter(StartMiddleEnd!="middle")%>%
  #Make a start and end date variable
  mutate(StartDate=case_when(StartMiddleEnd=="start"~paste(sample_id_date),
                             StartMiddleEnd=="end"~paste(lag(sample_id_date,1)),
                             StartMiddleEnd=="start+end"~paste(sample_id_date)))%>%
  mutate(EndDate=case_when(StartMiddleEnd=="start"~paste(lead(sample_id_date,1)),
                           StartMiddleEnd=="end"~paste(sample_id_date),
                           StartMiddleEnd=="start+end"~paste(sample_id_date)))%>%
  #Calculate time from end to next start
  mutate(toNext = case_when(grepl("end",StartMiddleEnd)~paste(as.Date(lead(StartDate,1))-as.Date(EndDate))))%>%
  #Remove start of infections
  filter(!StartMiddleEnd=="start")%>%
  #Add censoring for end of infections not followed by a reinfecion
  mutate(EventCensored = if_else(toNext!="NA","1","0"))%>%
  mutate(Days = if_else(EventCensored==1,paste0(toNext),paste0(as.Date("20180731","%Y%m%d") - as.Date(sample_id_date))))%>%
  #Make age category
  mutate(ageCat = case_when(age_y_baseline <= 5 ~ "<5",
                            age_y_baseline >5 & age_y_baseline < 15 ~ "5-15",
                            age_y_baseline >= 15 ~ ">15"))%>%
    mutate(ageCat=factor(ageCat,levels=c("<5","5-15",">15")))

# define symptomatic status
classified_infections <- classified_infections %>%
  filter(symptomatic_status %in% c("asymptomatic infection", "symptomatic infection")) %>%
  dplyr::select(-c(main_exposure_primary_case_def,main_outcome_primary_case_def)) %>%
  mutate(Days=as.numeric(Days))%>%
  mutate(EventCensored=as.numeric(EventCensored))


classified_infections  <- classified_infections %>%
  mutate(collection_year = year(sample_id_date), collection_week = week(sample_id_date), week_year = paste0(collection_week,"_", collection_year)) %>%
  ungroup() %>%
  select(-collection_year, -collection_week) %>%
  left_join(season)

#there is missing data for the  first weeks of the study. In both cases, the number of mosquitoes in THAT week was > 50, so we will assume that the sum of the previous weeks was also > 50 We will use the mosquito counts closest to those weeks.

classified_infections$mosquito_prev_2weeks_cat[classified_infections$week_year == "24_2017"] <- "> 50 mosquitoes"
classified_infections$mosquito_prev_2weeks_cat[classified_infections$week_year == "25_2017"] <- "> 50 mosquitoes"
classified_infections$mosquito_prev_2weeks_cat[classified_infections$week_year == "26_2017"] <- "> 50 mosquitoes"

#additionally, over the holidays we were missing 2 weeks of mozzie collections, but the previous two weeks had a small handfull of mosquitoes
classified_infections$mosquito_prev_2weeks_cat[classified_infections$week_year == "51_2017"] <- "0 - 50 mosquitoes"
classified_infections$mosquito_prev_2weeks_cat[classified_infections$week_year == "52_2017"] <- "0 - 50 mosquitoes"



#saveRDS(classified_infections, "data/processed/classified_infections.RDS")

```



# Overall risk of reinfection
```{r}
fit_surv <- survfit(Surv(Days,EventCensored)~1,data=classified_infections)

fit_surv

summary(fit_surv, times = 365.25)

fit_surv_strat <-survfit(Surv(Days,EventCensored)~symptomatic_status,data=classified_infections)

fit_surv_strat

summary(fit_surv_strat, times = 365.25)

```

# Survival curve
```{r}
figFA <- ggsurvplot_combine(list(fit_surv_strat, fit_surv),
                data = classified_infections,
                risk.table = TRUE,
                xlab=("Time in days"),
                ylab=("Probability of survival without reinfection"),
                font.main = c(12),
                font.x = c(10),
                font.y = c(10),
                font.tickslab = c(8),
                fontsize = 4,
                risk.table.fontsize = 4,
                palette = c(strat_colors, "black"),
                tables.theme = theme_cleantable(),
                tables.height = 0.25,
                tables.col = "strata",
                legend = "none",
                legend.title = "Index infection",
                legend.labs = c("Asx", "Sx", "All"),
                conf.int = TRUE,title="Time to reinfection",xlim=c(-10,400))
figFA
```


# Cox mixed-effects model
```{r}
cox_fig<-coxme(Surv(Days,EventCensored)~ageCat+gender+symptomatic_status+mosquito_prev_2weeks_cat+(1|unq_memID),data=classified_infections)

cox_fig

coeff1<-fixef(cox_fig)

coxmetable_fig<-as.data.frame(exp(confint(cox_fig)))

coxmetable_fig<-cbind(coxmetable_fig,exp(coeff1))
#Change labels for plot
coxmetable_fig$label<-row.names(coxmetable_fig)
coxmetable_fig$label[1]="Age 5-15"
coxmetable_fig$label[2]="Age >15"
coxmetable_fig$label[3]="Male"
coxmetable_fig$label[4]="Symptomatic"
coxmetable_fig$label[5]="Mosquitoes > 50"
#Table
coxmetable_fig
#Plot
figFB <- ggplot(coxmetable_fig,aes(y=label,x=exp(coeff1),xmin=`2.5 %`, xmax=`97.5 %`))+
  geom_pointrange(size=1,shape=18)+
  geom_vline(xintercept=1, lty=2)+
  theme_bw()+
  ylab("")+
  xlab("Adj. HR (95%)")
figFB

```


# Combine figures
```{r}
figF <- ggarrange(
  ggarrange(figFA$plot,
            figFA$table +
              theme(
                plot.title = element_text(size = 12)),
            heights = c(1,0.3),
            ncol = 1,
            align = "v"),
  figFB,
  nrow = 1,
  labels = c("A", "B"),
  hjust = 0,
  vjust = 1,
  widths = c(1.5,1))

figF


#ggsave(plot = figF, "epitopes/MozzieAminoAcidAnalysis/cfm_figures/figF_mod.png", width = 6, height = 4)


```


# Exploring case classification
```{r, fig.height= 24, fig.width=6}
all_infections <- HumanData %>%
  select(unq_memID,pf_pcr_infection_status,sample_id_date,sample_name_dbs,age_y_baseline,gender,pfr364Q_std_combined, main_exposure_primary_case_def, main_outcome_primary_case_def)%>%
  mutate(symptomatic_status = ifelse(is.na(main_exposure_primary_case_def), as.character(main_outcome_primary_case_def),as.character(main_exposure_primary_case_def))) %>%
  arrange(unq_memID, sample_id_date) %>% 
  group_by(unq_memID) %>% 
  #add columns for previous and next infections so that we can filter out anything within 14 days of a symptomatic infection
  mutate(pcr_next = lead(pf_pcr_infection_status,1),
         pcr_prev = lag(pf_pcr_infection_status,1),
         Sx_next = lead(symptomatic_status,1),
         Sx_prev = lag(symptomatic_status,1),
         days_since_prev = ymd(sample_id_date) - ymd(lag(sample_id_date,1))) %>%
  #remove positive samples within 14 days of a symptomatic infection (there are 25 of them)
  filter(Sx_prev != "symptomatic infection"| is.na(Sx_prev) | days_since_prev > days(14) | pf_pcr_infection_status != "positive") %>%
  #do it again to see if there are any other positive samples within 14 days of a symptomatic infection
  mutate(pcr_next = lead(pf_pcr_infection_status,1),
         pcr_prev = lag(pf_pcr_infection_status,1),
         Sx_next = lead(symptomatic_status,1),
         Sx_prev = lag(symptomatic_status,1),
         days_since_prev = ymd(sample_id_date) - ymd(lag(sample_id_date,1))) %>% #no more samples needed to be removed
  select(-days_since_prev) %>%
  #define whether samples are the the start middle or end of an infection
  mutate(StartMiddleEnd=case_when(pf_pcr_infection_status=="negative" ~ "negative",
                                  symptomatic_status == "symptomatic infection" & (pcr_prev == "negative" | is.na(pcr_prev) ) ~ "start+end",
                                  symptomatic_status == "symptomatic infection" & pcr_prev == "positive" & Sx_prev == "symptomatic infection" ~ "start+end",
                                  symptomatic_status == "symptomatic infection" & pcr_prev == "positive" & (Sx_prev == "asymptomatic infection" | is.na(Sx_prev)) ~ "end",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & (pcr_prev == "negative" | is.na(pcr_prev)) & (pcr_next == "negative" | is.na(pcr_next)) ~ "start+end",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & (pcr_prev == "negative" | is.na(pcr_prev)) & pcr_next == "positive" ~ "start",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & pcr_prev == "positive" & Sx_prev == "symptomatic infection" & (pcr_next == "negative" | is.na(pcr_next)) ~ "start+end",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & pcr_prev == "positive" & Sx_prev == "symptomatic infection" & pcr_next == "positive" ~ "start",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & pcr_prev == "positive" & (Sx_prev == "asymptomatic infection" | is.na(Sx_prev)) & (pcr_next == "negative" | is.na(pcr_next)) ~ "end",
                                  (symptomatic_status == "asymptomatic infection" | is.na(symptomatic_status)) & pcr_prev == "positive" & (Sx_prev == "asymptomatic infection" | is.na(Sx_prev)) & pcr_next == "positive" ~ "middle"))

saveRDS(all_infections, "data/processed/all_infections_classified.RDS")

table(all_infections$symptomatic_status[all_infections$pf_pcr_infection_status == "positive"], all_infections$StartMiddleEnd[all_infections$pf_pcr_infection_status == "positive"], useNA = "ifany")


ggplot(all_infections, aes(x = ymd(sample_id_date), y = unq_memID))+
  geom_count(aes(color = StartMiddleEnd, fill = factor(symptomatic_status, levels = c("symptomatic infection", "asymptomatic infection", "no infection", NA))), shape = 21, size = 2) +
  scale_fill_manual(values = c("#F8766D", "#00BFC4", adjustcolor("white", alpha.f = 0)), name = "symptomatic_status") +
  scale_color_manual(values = c("black", "white", "grey", "white", "black"))+
  theme_bw()

```


# Remove events w/time to reinfection < 60 days
Updated 2/23/2022 - Erica Zeno
```{r}
#Removing reinfections in the first 60 days after an episode
classified_infections <- classified_infections %>% 
  mutate(cutoff_60=ifelse(Days>60,1,0))

classified_infections_60 <- classified_infections %>% filter(cutoff_60==1)


fit_surv60 <- survfit(Surv(Days,EventCensored)~1,data=classified_infections_60)

fit_surv60

summary(fit_surv60, times = 365.25)

fit_surv_strat60 <-survfit(Surv(Days,EventCensored)~symptomatic_status,data=classified_infections_60)

fit_surv_strat60

summary(fit_surv_strat60, times = 365.25)


figFA_60 <- ggsurvplot_combine(list(fit_surv_strat60, fit_surv60),
                data = classified_infections,
                risk.table = TRUE,
                xlab=("Time in days"),
                ylab=("Probability of survival without reinfection"),
                font.main = c(12),
                font.x = c(10),
                font.y = c(10),
                font.tickslab = c(8),
                fontsize = 4,
                risk.table.fontsize = 4,
                palette = c(strat_colors, "black"),
                tables.theme = theme_cleantable(),
                tables.height = 0.25,
                tables.col = "strata",
                legend = "none",
                legend.title = "Index infection",
                legend.labs = c("Asx", "Sx", "All"),
                conf.int = TRUE,title="Time to reinfection",xlim=c(-10,400))
figFA_60

#cox model and plot of HRs
cox_fig_60<-coxme(Surv(Days,EventCensored)~ageCat+gender+symptomatic_status+mosquito_prev_2weeks_cat+(1|unq_memID),data=classified_infections_60)

cox_fig_60

coeff1_60<-fixef(cox_fig_60)

coxmetable_fig_60<-as.data.frame(exp(confint(cox_fig_60)))

coxmetable_fig_60<-cbind(coxmetable_fig_60,exp(coeff1_60))
#Change labels for plot
coxmetable_fig_60$label<-row.names(coxmetable_fig_60)
coxmetable_fig_60$label[1]="Age 5-15"
coxmetable_fig_60$label[2]="Age >15"
coxmetable_fig_60$label[3]="Male"
coxmetable_fig_60$label[4]="Symptomatic"
coxmetable_fig_60$label[5]="> 50 mosquitoes"
#Table
coxmetable_fig_60 <- coxmetable_fig_60 %>%
  rename("aHR" = "exp(coeff1_60)")

coxmetable_fig_60$label <- factor(coxmetable_fig_60$label, levels = c("Age >15", "Age 5-15", "Male", "> 50 mosquitoes", "Symptomatic"))
#Plot
figFB_60 <- ggplot(coxmetable_fig_60,aes(y=label,x=aHR,xmin=`2.5 %`, xmax=`97.5 %`))+
  geom_pointrange(size=1,shape=18)+
  scale_x_continuous(trans = "log") +
  geom_vline(xintercept=1, lty=2)+
  theme_bw()+
  ylab("")+
  xlab("Adj. HR (95%)")
figFB_60


coxmetable_fig_60

#combine 
figF_60 <- ggarrange(
  ggarrange(figFA_60$plot +
              geom_vline(xintercept = 60, linetype = "dotted") +
            scale_x_continuous(breaks = c(0,60,100,200,300,400)) +
            theme_bw() +
              theme(legend.position = "none", plot.title = element_blank()),
            figFA_60$table +
              theme(
                plot.title = element_text(size = 12)),
            heights = c(1,0.3),
            ncol = 1,
            align = "v"),
  figFB_60,
  nrow = 1,
  labels = c("A", "B"),
  hjust = 0,
  vjust = 1,
  widths = c(1.5,1))

figF_60

ggsave(plot = figF_60, "figures/overall_reinfection.png", width = 8, height = 5)


```

# Table 1
Age, sex, transmission season, parasite density
```{r}
library(gtsummary)

classified_infections_60 %>%
  select(ageCat, gender, mosquito_prev_2weeks_cat, pfr364Q_std_combined, symptomatic_status) %>%
  tbl_summary(by = symptomatic_status, digits = all_continuous() ~ 2) %>%
  add_p() %>%
  add_overall()
```

**No of subsequent episodes**
```{r}
classified_infections_60 %>%
  group_by(unq_memID) %>%
  mutate(total_episodes = n()) %>%
  arrange(ymd(sample_id_date)) %>%
  mutate(episode_no = row_number(unq_memID), subsequent_episodes = total_episodes - episode_no) %>%
  ungroup() %>%
  select(symptomatic_status, subsequent_episodes) %>%
  tbl_summary(by = symptomatic_status, 
              digits = all_continuous() ~ 2, 
              type = everything() ~ "continuous") %>%
  add_p() %>%
  add_overall()
  

classified_infections_60 %>%
  group_by(unq_memID) %>%
  mutate(total_episodes = n()) %>%
  arrange(ymd(sample_id_date)) %>%
  mutate(episode_no = row_number(unq_memID), subsequent_episodes = total_episodes - episode_no) %>%
  ungroup() %>%
  select(symptomatic_status, subsequent_episodes) %>%
  tbl_summary(by = symptomatic_status) %>%
  add_p() #%>%
  #add_overall()
  
```


**subsequent infections/month**
```{r}
classified_infections_60 %>%
  group_by(unq_memID) %>%
  mutate(total_episodes = n()) %>%
  arrange(ymd(sample_id_date)) %>%
  mutate(episode_no = row_number(unq_memID), subsequent_episodes = total_episodes - episode_no) %>%
  ungroup() %>%
  mutate(months_to_end = as.period(max(ymd(sample_id_date))-ymd(sample_id_date)) %/% months(1), subsequent_permonth =  ifelse(subsequent_episodes == 0,0, subsequent_episodes/as.numeric(months_to_end))) %>%
  select(symptomatic_status, subsequent_permonth) %>%
  tbl_summary(by = symptomatic_status) %>%
  add_p() %>%
  add_overall()



```



**MOI and read coverage**
Will need to import deep sequencing data for this one and merge.
```{r}
csp <- read_csv("data/original/spat21_csp_summarized_haplotype_list_31DEC2019.csv")
ama <- read_csv("data/original/spat21_ama_summarized_haplotype_list_31DEC2019.csv")

classified_infections_60 %>%
  left_join(csp, by = "sample_name_dbs") %>%
  rename(csp_moi = haplotype_number,
         csp_reads = haplotype_reads,
         csp_haps = haplotype_list) %>%
  left_join(ama, by = "sample_name_dbs") %>%
  rename(ama_moi = haplotype_number,
         ama_reads = haplotype_reads,
         ama_haps = haplotype_list) %>%
  mutate(moi = pmax(csp_moi, ama_moi, na.rm = TRUE),
         moi_cat = ifelse(moi < 2, "1",
                          ifelse(moi > 1 & moi < 6, "2-5",
                                 ifelse(moi > 5, "> 5", NA)))) %>%
  select(symptomatic_status, moi, moi_cat, csp_reads, ama_reads) %>%
  tbl_summary(by = symptomatic_status) %>%
  add_p() %>%
  add_overall()

```

**MOI of subsequent infection**
```{r}
classified_infections_60 %>%
  left_join(csp, by = "sample_name_dbs") %>%
  rename(csp_moi = haplotype_number,
         csp_reads = haplotype_reads,
         csp_haps = haplotype_list) %>%
  left_join(ama, by = "sample_name_dbs") %>%
  rename(ama_moi = haplotype_number,
         ama_reads = haplotype_reads,
         ama_haps = haplotype_list) %>%
  mutate(moi = pmax(csp_moi, ama_moi, na.rm = TRUE),
         moi_cat = ifelse(moi < 2, "1",
                          ifelse(moi > 1 & moi < 6, "2-5",
                                 ifelse(moi > 5, "> 5", NA)))) %>%
  group_by(unq_memID) %>%
  arrange(ymd(sample_id_date)) %>%
  mutate(total_episodes = n(), episode_no = row_number(unq_memID), subsequent_episodes = total_episodes - episode_no) %>%
  mutate(moi_next = lead(moi),
         moi_cat_next = lead(moi_cat)) %>%
  ungroup() %>%
  select(symptomatic_status, moi_next, moi_cat_next) %>%
  tbl_summary(by = symptomatic_status) %>%
  add_p() %>%
  add_overall()
```


# Table S1
Checking the distribution of variables before and after 60 days - EZ March 2022 
```{r, warning=F,message=F}
popcheck_overall<-classified_infections

#cutoff_60 is variable before and after? greater than 60 vs less than or equal to 60

#time to censoring, mean, days
popcheck_overall %>% 
  group_by(cutoff_60) %>% 
  summarize_at(vars(Days), list(name = mean))
  
mean(popcheck_overall$Days)

t.test(popcheck_overall$Days, popcheck_overall$cutoff_60)


#symptomatic status
table(popcheck_overall$symptomatic_status,useNA = "always")
popcheck_overall %>%
  group_by(symptomatic_status) %>%
  summarise(n=(n()))
popcheck_overall %>%
  group_by(symptomatic_status,cutoff_60) %>%
  summarise(n=n())

CrossTable(popcheck_overall$symptomatic_status, popcheck_overall$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS"))


#Age
table(popcheck_overall$ageCat,useNA = "always")
popcheck_overall %>%
  group_by(ageCat) %>%
  summarise(n=(n()))
popcheck_overall %>%
  group_by(ageCat,cutoff_60) %>%
  summarise(n=n())


CrossTable(popcheck_overall$ageCat, popcheck_overall$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS"))


#Sex
table(popcheck_overall$gender,useNA = "always")
popcheck_overall %>%
  group_by(gender) %>%
  summarise(n=(n()))
popcheck_overall %>%
  group_by(gender,cutoff_60) %>%
  summarise(n=n())


CrossTable(popcheck_overall$gender, popcheck_overall$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS"))

#Transmission Season
table(popcheck_overall$mosquito_prev_2weeks_cat,useNA = "always")
popcheck_overall %>%
  group_by(mosquito_prev_2weeks_cat) %>%
  summarise(n=(n()))
popcheck_overall %>%
  group_by(mosquito_prev_2weeks_cat, cutoff_60) %>%
  summarise(n=(n()))


CrossTable(popcheck_overall$mosquito_prev_2weeks_cat, popcheck_overall$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS"))


CrossTable(popcheck_overall$symptomatic_status, popcheck_overall$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS"))

CrossTable(popcheck_overall$ageCat, popcheck_overall$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS"))

CrossTable(popcheck_overall$gender, popcheck_overall$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS"))

CrossTable(popcheck_overall$mosquito_prev_2weeks_cat, popcheck_overall$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS"))

#one way to get frequencies and do tests of independence
symp_table <- xtabs(~symptomatic_status+cutoff_60, data=popcheck_overall)
ftable(symp_table)
summary(symp_table)

```



# MOI in the model
```{r}
csp <- read_csv("data/original/spat21_csp_summarized_haplotype_list_31DEC2019.csv")
ama <- read_csv("data/original/spat21_ama_summarized_haplotype_list_31DEC2019.csv")

classified_inf_60_moi <- classified_infections_60 %>%
  left_join(csp, by = "sample_name_dbs") %>%
  rename(csp_moi = haplotype_number,
         csp_reads = haplotype_reads,
         csp_haps = haplotype_list) %>%
  left_join(ama, by = "sample_name_dbs") %>%
  rename(ama_moi = haplotype_number,
         ama_reads = haplotype_reads,
         ama_haps = haplotype_list) %>%
  mutate(moi = pmax(csp_moi, ama_moi, na.rm = TRUE),
         moi_cat = ifelse(moi < 2, "1",
                          ifelse(moi > 1 & moi < 6, "2-5",
                                 ifelse(moi > 5, "> 5", NA))),
         mosquito_prev_2weeks_cat = factor(mosquito_prev_2weeks_cat, levels = c("0 - 50 mosquitoes", "> 50 mosquitoes"))) %>%
  filter(!is.na(moi), !is.na(ageCat), !is.na(gender), !is.na(symptomatic_status), !is.na(mosquito_prev_2weeks_cat))

cox_60_restrict <- coxme(Surv(Days,EventCensored)~ageCat+gender+symptomatic_status+mosquito_prev_2weeks_cat+(1|unq_memID),data=classified_inf_60_moi)

cox_60_restrict
exp(confint(cox_60_restrict))

cox_60_moicont <-coxme(Surv(Days,EventCensored)~ageCat+gender+symptomatic_status+mosquito_prev_2weeks_cat+moi+(1|unq_memID),data=classified_inf_60_moi)

cox_60_moicont
exp(confint(cox_60_moicont))


classified_inf_60_moi$moi_cat <- factor(classified_inf_60_moi$moi_cat, levels = c("1", "2-5", "> 5"))

cox_60_moicat <-coxme(Surv(Days,EventCensored)~ageCat+gender+symptomatic_status+mosquito_prev_2weeks_cat+moi_cat+(1|unq_memID),data=classified_inf_60_moi)

cox_60_moicat
exp(confint(cox_60_moicat))

anova(cox_60_moicont, cox_60_restrict)
anova(cox_60_moicat, cox_60_restrict)

extractAIC.coxme <- function(x){
  loglik <- x$loglik + c(0, 0, x$penalty)
  chi1 <- 2*diff(loglik[1:2]) 
  chi2 <- 2*diff(loglik[c(1,3)])
  c(chi1 - 2*x$df[1], chi2 - 2*x$df[2])
}

extractAIC(cox_60_restrict) #model without moi
extractAIC(cox_60_moicont) #model with continuous moi
extractAIC(cox_60_moicat) #model with categorical moi


classified_inf_60_moi %>%
  ggplot() +
  aes(x = moi) +
  geom_histogram(binwidth = 1)

summary(classified_inf_60_moi$moi_cat)

```
<!-- # Fig 2 -->

<!-- ```{r} -->
<!-- fit_surv60_moi <- survfit(Surv(Days,EventCensored)~1,data=classified_inf_60_moi) -->

<!-- fit_surv60_moi -->

<!-- summary(fit_surv60_moi, times = 365.25) -->

<!-- fit_surv_strat60_moi <-survfit(Surv(Days,EventCensored)~symptomatic_status,data=classified_inf_60_moi) -->

<!-- fit_surv_strat60_moi -->

<!-- #need to fix -->
<!-- summary(fit_surv_strat60_moi, times = 365.25, extend = TRUE) -->


<!-- figFA_60_moi <- ggsurvplot_combine(list(fit_surv_strat60_moi, fit_surv60_moi), -->
<!--                 data = classified_infections, -->
<!--                 risk.table = TRUE, -->
<!--                 xlab=("Time in days"), -->
<!--                 ylab=("Probability of survival without reinfection"), -->
<!--                 font.main = c(12), -->
<!--                 font.x = c(10), -->
<!--                 font.y = c(10), -->
<!--                 font.tickslab = c(8), -->
<!--                 fontsize = 4, -->
<!--                 risk.table.fontsize = 4, -->
<!--                 palette = c(strat_colors, "black"), -->
<!--                 tables.theme = theme_cleantable(), -->
<!--                 tables.height = 0.25, -->
<!--                 tables.col = "strata", -->
<!--                 legend = "none", -->
<!--                 legend.title = "Index infection", -->
<!--                 legend.labs = c("Asx", "Sx", "All"), -->
<!--                 conf.int = TRUE,title="Time to reinfection",xlim=c(-10,400)) -->
<!-- figFA_60_moi -->

<!-- #cox model and plot of HRs -->
<!-- cox_fig_60_moi<-coxme(Surv(Days,EventCensored)~ageCat+gender+symptomatic_status+mosquito_prev_2weeks_cat+moi_cat+(1|unq_memID),data=classified_inf_60_moi) -->

<!-- cox_fig_60_moi -->

<!-- coeff1_60_moi<-fixef(cox_fig_60_moi) -->

<!-- coxmetable_fig_60_moi<-as.data.frame(exp(confint(cox_fig_60_moi))) -->

<!-- coxmetable_fig_60_moi<-cbind(coxmetable_fig_60_moi,exp(coeff1_60_moi)) -->
<!-- #Change labels for plot -->
<!-- coxmetable_fig_60_moi$label<-row.names(coxmetable_fig_60_moi) -->
<!-- coxmetable_fig_60_moi$label[1]="Age 5-15" -->
<!-- coxmetable_fig_60_moi$label[2]="Age >15" -->
<!-- coxmetable_fig_60_moi$label[3]="Male" -->
<!-- coxmetable_fig_60_moi$label[4]="Symptomatic" -->
<!-- coxmetable_fig_60_moi$label[5]="> 50 mosquitoes" -->
<!-- coxmetable_fig_60_moi$label[6]="MOI 2-5" -->
<!-- coxmetable_fig_60_moi$label[7]="MOI > 5" -->
<!-- #Table -->
<!-- coxmetable_fig_60_moi <- coxmetable_fig_60_moi %>% -->
<!--   rename("aHR" = "exp(coeff1_60_moi)") -->

<!-- coxmetable_fig_60_moi$label <- factor(coxmetable_fig_60_moi$label, levels = c("MOI > 5","MOI 2-5","Age >15", "Age 5-15", "Male", "> 50 mosquitoes", "Symptomatic")) -->
<!-- #Plot -->
<!-- figFB_60_moi <- ggplot(coxmetable_fig_60_moi,aes(y=label,x=aHR,xmin=`2.5 %`, xmax=`97.5 %`))+ -->
<!--   geom_pointrange(size=1,shape=18)+ -->
<!--   scale_x_continuous(trans = "log") + -->
<!--   geom_vline(xintercept=1, lty=2)+ -->
<!--   theme_bw()+ -->
<!--   ylab("")+ -->
<!--   xlab("Adj. HR (95%)") -->
<!-- figFB_60_moi -->


<!-- coxmetable_fig_60_moi -->

<!-- #combine  -->
<!-- figF_60_moi <- ggarrange( -->
<!--   ggarrange(figFA_60_moi$plot + -->
<!--               geom_vline(xintercept = 60, linetype = "dotted") + -->
<!--             scale_x_continuous(breaks = c(0,60,100,200,300,400)) + -->
<!--             theme_bw() + -->
<!--               theme(legend.position = "none", plot.title = element_blank()), -->
<!--             figFA_60_moi$table + -->
<!--               theme( -->
<!--                 plot.title = element_text(size = 12)), -->
<!--             heights = c(1,0.3), -->
<!--             ncol = 1, -->
<!--             align = "v"), -->
<!--   figFB_60_moi, -->
<!--   nrow = 1, -->
<!--   labels = c("A", "B"), -->
<!--   hjust = 0, -->
<!--   vjust = 1, -->
<!--   widths = c(1.5,1)) -->

<!-- figF_60_moi -->

<!-- ggsave(plot = figF_60_moi, "figures/overall_reinfection_moi.png", width = 8, height = 5) -->



<!-- ``` -->


<!-- # Revised Table 1 -->
<!-- Age, sex, transmission season, parasite density -->
<!-- ```{r} -->
<!-- library(gtsummary) -->

<!-- classified_inf_60_moi %>% -->
<!--   select(ageCat, gender, mosquito_prev_2weeks_cat, pfr364Q_std_combined, symptomatic_status, moi, moi_cat, csp_reads, ama_reads) %>% -->
<!--   tbl_summary(by = symptomatic_status, digits = all_continuous() ~ 2) %>% -->
<!--   add_p() %>% -->
<!--   add_overall() -->
<!-- ``` -->

<!-- **No of subsequent episodes** -->
<!-- ```{r} -->
<!-- classified_inf_60_moi %>% -->
<!--   group_by(unq_memID) %>% -->
<!--   mutate(total_episodes = n()) %>% -->
<!--   arrange(ymd(sample_id_date)) %>% -->
<!--   mutate(episode_no = row_number(unq_memID), subsequent_episodes = total_episodes - episode_no) %>% -->
<!--   ungroup() %>% -->
<!--   select(symptomatic_status, subsequent_episodes) %>% -->
<!--   tbl_summary(by = symptomatic_status,  -->
<!--               digits = all_continuous() ~ 2,  -->
<!--               type = everything() ~ "continuous") %>% -->
<!--   add_p() %>% -->
<!--   add_overall() -->


<!-- classified_inf_60_moi %>% -->
<!--   group_by(unq_memID) %>% -->
<!--   mutate(total_episodes = n()) %>% -->
<!--   arrange(ymd(sample_id_date)) %>% -->
<!--   mutate(episode_no = row_number(unq_memID), subsequent_episodes = total_episodes - episode_no) %>% -->
<!--   ungroup() %>% -->
<!--   select(symptomatic_status, subsequent_episodes) %>% -->
<!--   tbl_summary(by = symptomatic_status) %>% -->
<!--   add_p() #%>% -->
<!--   #add_overall() -->

<!-- ``` -->


<!-- **subsequent infections/month** -->
<!-- ```{r} -->
<!-- classified_inf_60_moi %>% -->
<!--   group_by(unq_memID) %>% -->
<!--   mutate(total_episodes = n()) %>% -->
<!--   arrange(ymd(sample_id_date)) %>% -->
<!--   mutate(episode_no = row_number(unq_memID), subsequent_episodes = total_episodes - episode_no) %>% -->
<!--   ungroup() %>% -->
<!--   mutate(months_to_end = as.period(max(ymd(sample_id_date))-ymd(sample_id_date)) %/% months(1), subsequent_permonth =  ifelse(subsequent_episodes == 0,0, subsequent_episodes/as.numeric(months_to_end))) %>% -->
<!--   select(symptomatic_status, subsequent_permonth) %>% -->
<!--   tbl_summary(by = symptomatic_status) %>% -->
<!--   add_p() %>% -->
<!--   add_overall() -->



<!-- ``` -->



<!-- **MOI of subsequent infection** -->
<!-- ```{r} -->
<!-- classified_inf_60_moi %>% -->
<!--   group_by(unq_memID) %>% -->
<!--   arrange(ymd(sample_id_date)) %>% -->
<!--   mutate(total_episodes = n(), episode_no = row_number(unq_memID), subsequent_episodes = total_episodes - episode_no) %>% -->
<!--   mutate(moi_next = lead(moi), -->
<!--          moi_cat_next = lead(moi_cat)) %>% -->
<!--   ungroup() %>% -->
<!--   select(symptomatic_status, moi_next, moi_cat_next) %>% -->
<!--   tbl_summary(by = symptomatic_status) %>% -->
<!--   add_p() %>% -->
<!--   add_overall() -->
<!-- ``` -->

<!-- # Revised Table S1 -->
<!-- ```{r} -->
<!-- popcheck_overall_moi<-classified_infections %>% -->
<!--   left_join(csp, by = "sample_name_dbs") %>% -->
<!--   rename(csp_moi = haplotype_number, -->
<!--          csp_reads = haplotype_reads, -->
<!--          csp_haps = haplotype_list) %>% -->
<!--   left_join(ama, by = "sample_name_dbs") %>% -->
<!--   rename(ama_moi = haplotype_number, -->
<!--          ama_reads = haplotype_reads, -->
<!--          ama_haps = haplotype_list) %>% -->
<!--   mutate(moi = pmax(csp_moi, ama_moi, na.rm = TRUE), -->
<!--          moi_cat = ifelse(moi < 2, "1", -->
<!--                           ifelse(moi > 1 & moi < 6, "2-5", -->
<!--                                  ifelse(moi > 5, "> 5", NA)))) %>% -->
<!--   filter(!is.na(moi_cat)) -->

<!-- #cutoff_60 is variable before and after? greater than 60 vs less than or equal to 60 -->

<!-- #time to censoring, mean, days -->
<!-- popcheck_overall_moi %>%  -->
<!--   group_by(cutoff_60) %>%  -->
<!--   summarize_at(vars(Days), list(name = mean)) -->

<!-- mean(popcheck_overall_moi$Days) -->

<!-- t.test(popcheck_overall_moi$Days, popcheck_overall_moi$cutoff_60) -->


<!-- #symptomatic status -->
<!-- table(popcheck_overall_moi$symptomatic_status,useNA = "always") -->
<!-- popcheck_overall_moi %>% -->
<!--   group_by(symptomatic_status) %>% -->
<!--   summarise(n=(n())) -->
<!-- popcheck_overall_moi %>% -->
<!--   group_by(symptomatic_status,cutoff_60) %>% -->
<!--   summarise(n=n()) -->

<!-- CrossTable(popcheck_overall_moi$symptomatic_status, popcheck_overall_moi$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS")) -->


<!-- #Age -->
<!-- table(popcheck_overall_moi$ageCat,useNA = "always") -->
<!-- popcheck_overall_moi %>% -->
<!--   group_by(ageCat) %>% -->
<!--   summarise(n=(n())) -->
<!-- popcheck_overall_moi %>% -->
<!--   group_by(ageCat,cutoff_60) %>% -->
<!--   summarise(n=n()) -->


<!-- CrossTable(popcheck_overall_moi$ageCat, popcheck_overall_moi$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS")) -->


<!-- #Sex -->
<!-- table(popcheck_overall_moi$gender,useNA = "always") -->
<!-- popcheck_overall_moi %>% -->
<!--   group_by(gender) %>% -->
<!--   summarise(n=(n())) -->
<!-- popcheck_overall_moi %>% -->
<!--   group_by(gender,cutoff_60) %>% -->
<!--   summarise(n=n()) -->


<!-- CrossTable(popcheck_overall_moi$gender, popcheck_overall_moi$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS")) -->

<!-- #Transmission Season -->
<!-- table(popcheck_overall_moi$mosquito_prev_2weeks_cat,useNA = "always") -->
<!-- popcheck_overall_moi %>% -->
<!--   group_by(mosquito_prev_2weeks_cat) %>% -->
<!--   summarise(n=(n())) -->
<!-- popcheck_overall_moi %>% -->
<!--   group_by(mosquito_prev_2weeks_cat, cutoff_60) %>% -->
<!--   summarise(n=(n())) -->


<!-- CrossTable(popcheck_overall_moi$mosquito_prev_2weeks_cat, popcheck_overall_moi$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS")) -->


<!-- CrossTable(popcheck_overall_moi$symptomatic_status, popcheck_overall_moi$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS")) -->

<!-- CrossTable(popcheck_overall_moi$ageCat, popcheck_overall_moi$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS")) -->

<!-- CrossTable(popcheck_overall_moi$gender, popcheck_overall_moi$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS")) -->

<!-- CrossTable(popcheck_overall_moi$mosquito_prev_2weeks_cat, popcheck_overall_moi$cutoff_60, prop.t=FALSE, prop.chisq=FALSE, chisq = TRUE, format=c("SAS")) -->

<!-- #one way to get frequencies and do tests of independence -->
<!-- symp_table <- xtabs(~symptomatic_status+cutoff_60, data=popcheck_overall_moi) -->
<!-- ftable(symp_table) -->
<!-- summary(symp_table) -->

<!-- ``` -->

<!-- ## playing around -->
<!-- ```{r} -->
<!-- # symp <- classified_inf_60_moi %>% -->
<!-- #   filter(symptomatic_status == "symptomatic infection") -->
<!-- #  -->
<!-- # df <- tibble() -->
<!-- # conf <- tibble() -->
<!-- #  -->
<!-- # for(i in 1:1000) { -->
<!-- #   asymp <- classified_inf_60_moi %>% -->
<!-- #   filter(symptomatic_status == "asymptomatic infection") %>% -->
<!-- #     slice_sample(n = 64) -->
<!-- #    -->
<!-- #    -->
<!-- #   simulate <- symp %>% -->
<!-- #     bind_rows(asymp) -->
<!-- #    -->
<!-- #   cox_simulate <- coxme(Surv(Days,EventCensored)~ageCat+gender+symptomatic_status+mosquito_prev_2weeks_cat+moi_cat+(1|unq_memID),data=simulate) -->
<!-- #    -->
<!-- #     df <- df %>% -->
<!-- #     bind_rows(cox_simulate$coefficients) -->
<!-- #      -->
<!-- #     conf <- conf %>% -->
<!-- #       bind_rows(data.frame(exp(confint(cox_simulate)))) -->
<!-- # } -->
<!-- #  -->
<!-- # conf_int <- conf %>% -->
<!-- #   rownames_to_column(var = "covariate") %>% -->
<!-- #   rownames_to_column(var = "index") %>% -->
<!-- #   mutate(i = ceiling(as.numeric(index)/7)) %>% -->
<!-- #   mutate(covariate = gsub("\\....*","",covariate)) -->





<!-- # df %>% -->
<!-- #   ggplot() + -->
<!-- #   aes(x = exp(`mosquito_prev_2weeks_cat> 50 mosquitoes`)) + -->
<!-- #   geom_histogram() -->
<!-- #  -->
<!-- # df %>% -->
<!-- #   ggplot() + -->
<!-- #   aes(x = `ageCat5-15`) + -->
<!-- #   geom_histogram() -->



<!-- ggplot(classified_inf_60_moi) + -->
<!--   aes(x = mosquito_prev_2weeks_cat, y = Days) + -->
<!--   geom_boxplot() -->

<!-- ggplot(classified_inf_60_moi) + -->
<!--   aes(x = mosquito_prev_2weeks_cat, y = Days) + -->
<!--   geom_boxplot() + -->
<!--   facet_wrap(~EventCensored) -->

<!-- classified_inf_60_moi %>% -->
<!--   ggplot() + -->
<!--   aes(x = sample_id_date, y = mosquito_prev_2weeks_cat) + -->
<!--   geom_point() + -->
<!--   theme(axis.text.x = element_text(angle = 90)) -->

<!-- classified_inf_60_moi %>% -->
<!--   ggplot() + -->
<!--   aes(x = ymd(sample_id_date), y = Days, color = mosquito_prev_2weeks_cat) + -->
<!--   geom_point() -->



<!-- coxme(Surv(Days,EventCensored)~ageCat+gender+symptomatic_status+mosquito_prev_2weeks_cat+moi_cat+(1|unq_memID),data=classified_inf_60_moi %>% filter(ymd(sample_id_date) < ymd("2018-01-01"), Days < 200)) -->

<!-- ``` -->


rmarkdown::render("C:/Users/cf199/Box/O\'Meara-Taylor Postdoc/mozzie_epitope_analysis/code/Overall_reinfection.Rmd", output_file=paste0('Overall_reinfection','_', Sys.Date(),'.html'),  encoding = 'UTF-8', knit_root_dir = "C:/Users/cf199/Box/O\'Meara-Taylor Postdoc/mozzie_epitope_analysis")

